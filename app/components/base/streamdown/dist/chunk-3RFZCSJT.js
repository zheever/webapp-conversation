"use client";
import {createContext,lazy,memo,useContext,isValidElement,useId,useTransition,useState,useMemo,useEffect,Suspense,useRef,useCallback}from'react';import {harden}from'rehype-harden';import xe from'rehype-katex';import xn from'rehype-raw';import vn from'rehype-sanitize';import Cn from'remark-cjk-friendly';import Tn from'remark-cjk-friendly-gfm-strikethrough';import Mn from'remark-gfm';import ve from'remark-math';import Pn from'remend';import {DownloadIcon,CheckIcon,CopyIcon,Maximize2Icon,XIcon,Loader2Icon,PlayIcon,ZoomInIcon,ZoomOutIcon,RotateCcwIcon}from'lucide-react';import {clsx}from'clsx';import {twMerge}from'tailwind-merge';import {jsx,jsxs,Fragment}from'react/jsx-runtime';import {toJsxRuntime}from'hast-util-to-jsx-runtime';import Jo from'remark-parse';import Wo from'remark-rehype';import {unified}from'unified';import {Lexer}from'marked';import Nt from'shiki/langs/bash.mjs';import sn from'shiki/langs/css.mjs';import Rt from'shiki/langs/go.mjs';import an from'shiki/langs/html.mjs';import ln from'shiki/langs/javascript.mjs';import cn from'shiki/langs/json.mjs';import dn from'shiki/langs/jsx.mjs';import St from'shiki/langs/markdown.mjs';import Et from'shiki/langs/python.mjs';import Dt from'shiki/langs/shellscript.mjs';import mn from'shiki/langs/sql.mjs';import pn from'shiki/langs/toml.mjs';import un from'shiki/langs/tsx.mjs';import fn from'shiki/langs/typescript.mjs';import It from'shiki/langs/yaml.mjs';var Vt=300,Xt="300px",_t=500;function Ce(e={}){let{immediate:t=false,debounceDelay:n=Vt,rootMargin:o=Xt,idleTimeout:a=_t}=e,[r,d]=useState(false),s=useRef(null),i=useRef(null),c=useRef(null),l=useMemo(()=>g=>{let u=Date.now();return window.setTimeout(()=>{g({didTimeout:false,timeRemaining:()=>Math.max(0,50-(Date.now()-u))});},1)},[]),p=useMemo(()=>typeof window!="undefined"&&window.requestIdleCallback?(g,u)=>window.requestIdleCallback(g,u):l,[l]),m=useMemo(()=>typeof window!="undefined"&&window.cancelIdleCallback?g=>window.cancelIdleCallback(g):g=>{clearTimeout(g);},[]);return useEffect(()=>{if(t){d(true);return}let g=s.current;if(!g)return;i.current&&(clearTimeout(i.current),i.current=null),c.current&&(m(c.current),c.current=null);let u=()=>{i.current&&(clearTimeout(i.current),i.current=null),c.current&&(m(c.current),c.current=null);},b=P=>{c.current=p(x=>{x.timeRemaining()>0||x.didTimeout?(d(true),P.disconnect()):c.current=p(()=>{d(true),P.disconnect();},{timeout:a/2});},{timeout:a});},h=P=>{u(),i.current=window.setTimeout(()=>{var S,L;let x=P.takeRecords();(x.length===0||((L=(S=x.at(-1))==null?void 0:S.isIntersecting)!=null?L:false))&&b(P);},n);},k=(P,x)=>{P.isIntersecting?h(x):u();},C=new IntersectionObserver(P=>{for(let x of P)k(x,C);},{rootMargin:o,threshold:0});return C.observe(g),()=>{i.current&&clearTimeout(i.current),c.current&&m(c.current),C.disconnect();}},[t,n,o,a,m,p]),{shouldRender:r,containerRef:s}}var f=(...e)=>twMerge(clsx(e)),I=(e,t,n)=>{let o=typeof t=="string"?new Blob([t],{type:n}):t,a=URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a);};var Zt=createContext({code:""}),F=()=>useContext(Zt);var Me=({onApply:e,onError:t,timeout:n=2e3,children:o,className:a,code:r,...d})=>{let[s,i]=useState(false),c=useRef(0),{code:l}=F(),{isAnimating:p}=useContext(M),m=r!=null?r:l,g=()=>{console.log("Apply functionality not yet implemented"),s||(i(true),e==null||e(m),c.current=window.setTimeout(()=>i(false),n));};useEffect(()=>()=>{window.clearTimeout(c.current);},[]);let u=s?CheckIcon:PlayIcon;return jsx("button",{className:f("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),"data-streamdown":"code-block-apply-button",disabled:p,onClick:g,title:"Apply Code",type:"button",...d,children:o!=null?o:jsx(u,{size:14})})};var ce=({onCopy:e,onError:t,timeout:n=2e3,children:o,className:a,code:r,...d})=>{let[s,i]=useState(false),c=useRef(0),{code:l}=F(),{isAnimating:p}=useContext(M),m=r!=null?r:l,g=async()=>{var b;if(typeof window=="undefined"||!((b=navigator==null?void 0:navigator.clipboard)!=null&&b.writeText)){t==null||t(new Error("Clipboard API not available"));return}try{s||(await navigator.clipboard.writeText(m),i(!0),e==null||e(),c.current=window.setTimeout(()=>i(!1),n));}catch(h){t==null||t(h);}};useEffect(()=>()=>{window.clearTimeout(c.current);},[]);let u=s?CheckIcon:CopyIcon;return jsx("button",{className:f("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),"data-streamdown":"code-block-copy-button",disabled:p,onClick:g,title:"Copy Code",type:"button",...d,children:o!=null?o:jsx(u,{size:14})})};var Ne={"1c":"1c","1c-query":"1cq",abap:"abap","actionscript-3":"as",ada:"ada",adoc:"adoc","angular-html":"html","angular-ts":"ts",apache:"conf",apex:"cls",apl:"apl",applescript:"applescript",ara:"ara",asciidoc:"adoc",asm:"asm",astro:"astro",awk:"awk",ballerina:"bal",bash:"sh",bat:"bat",batch:"bat",be:"be",beancount:"beancount",berry:"berry",bibtex:"bib",bicep:"bicep",blade:"blade.php",bsl:"bsl",c:"c","c#":"cs","c++":"cpp",cadence:"cdc",cairo:"cairo",cdc:"cdc",clarity:"clar",clj:"clj",clojure:"clj","closure-templates":"soy",cmake:"cmake",cmd:"cmd",cobol:"cob",codeowners:"CODEOWNERS",codeql:"ql",coffee:"coffee",coffeescript:"coffee","common-lisp":"lisp",console:"sh",coq:"v",cpp:"cpp",cql:"cql",crystal:"cr",cs:"cs",csharp:"cs",css:"css",csv:"csv",cue:"cue",cypher:"cql",d:"d",dart:"dart",dax:"dax",desktop:"desktop",diff:"diff",docker:"dockerfile",dockerfile:"dockerfile",dotenv:"env","dream-maker":"dm",edge:"edge",elisp:"el",elixir:"ex",elm:"elm","emacs-lisp":"el",erb:"erb",erl:"erl",erlang:"erl",f:"f","f#":"fs",f03:"f03",f08:"f08",f18:"f18",f77:"f77",f90:"f90",f95:"f95",fennel:"fnl",fish:"fish",fluent:"ftl",for:"for","fortran-fixed-form":"f","fortran-free-form":"f90",fs:"fs",fsharp:"fs",fsl:"fsl",ftl:"ftl",gdresource:"tres",gdscript:"gd",gdshader:"gdshader",genie:"gs",gherkin:"feature","git-commit":"gitcommit","git-rebase":"gitrebase",gjs:"js",gleam:"gleam","glimmer-js":"js","glimmer-ts":"ts",glsl:"glsl",gnuplot:"plt",go:"go",gql:"gql",graphql:"graphql",groovy:"groovy",gts:"gts",hack:"hack",haml:"haml",handlebars:"hbs",haskell:"hs",haxe:"hx",hbs:"hbs",hcl:"hcl",hjson:"hjson",hlsl:"hlsl",hs:"hs",html:"html","html-derivative":"html",http:"http",hxml:"hxml",hy:"hy",imba:"imba",ini:"ini",jade:"jade",java:"java",javascript:"js",jinja:"jinja",jison:"jison",jl:"jl",js:"js",json:"json",json5:"json5",jsonc:"jsonc",jsonl:"jsonl",jsonnet:"jsonnet",jssm:"jssm",jsx:"jsx",julia:"jl",kotlin:"kt",kql:"kql",kt:"kt",kts:"kts",kusto:"kql",latex:"tex",lean:"lean",lean4:"lean",less:"less",liquid:"liquid",lisp:"lisp",lit:"lit",llvm:"ll",log:"log",logo:"logo",lua:"lua",luau:"luau",make:"mak",makefile:"mak",markdown:"md",marko:"marko",matlab:"m",md:"md",mdc:"mdc",mdx:"mdx",mediawiki:"wiki",mermaid:"mmd",mips:"s",mipsasm:"s",mmd:"mmd",mojo:"mojo",move:"move",nar:"nar",narrat:"narrat",nextflow:"nf",nf:"nf",nginx:"conf",nim:"nim",nix:"nix",nu:"nu",nushell:"nu",objc:"m","objective-c":"m","objective-cpp":"mm",ocaml:"ml",pascal:"pas",perl:"pl",perl6:"p6",php:"php",plsql:"pls",po:"po",polar:"polar",postcss:"pcss",pot:"pot",potx:"potx",powerquery:"pq",powershell:"ps1",prisma:"prisma",prolog:"pl",properties:"properties",proto:"proto",protobuf:"proto",ps:"ps",ps1:"ps1",pug:"pug",puppet:"pp",purescript:"purs",py:"py",python:"py",ql:"ql",qml:"qml",qmldir:"qmldir",qss:"qss",r:"r",racket:"rkt",raku:"raku",razor:"cshtml",rb:"rb",reg:"reg",regex:"regex",regexp:"regexp",rel:"rel",riscv:"s",rs:"rs",rst:"rst",ruby:"rb",rust:"rs",sas:"sas",sass:"sass",scala:"scala",scheme:"scm",scss:"scss",sdbl:"sdbl",sh:"sh",shader:"shader",shaderlab:"shader",shell:"sh",shellscript:"sh",shellsession:"sh",smalltalk:"st",solidity:"sol",soy:"soy",sparql:"rq",spl:"spl",splunk:"spl",sql:"sql","ssh-config":"config",stata:"do",styl:"styl",stylus:"styl",svelte:"svelte",swift:"swift","system-verilog":"sv",systemd:"service",talon:"talon",talonscript:"talon",tasl:"tasl",tcl:"tcl",templ:"templ",terraform:"tf",tex:"tex",tf:"tf",tfvars:"tfvars",toml:"toml",ts:"ts","ts-tags":"ts",tsp:"tsp",tsv:"tsv",tsx:"tsx",turtle:"ttl",twig:"twig",typ:"typ",typescript:"ts",typespec:"tsp",typst:"typ",v:"v",vala:"vala",vb:"vb",verilog:"v",vhdl:"vhdl",vim:"vim",viml:"vim",vimscript:"vim",vue:"vue","vue-html":"html","vue-vine":"vine",vy:"vy",vyper:"vy",wasm:"wasm",wenyan:"wy",wgsl:"wgsl",wiki:"wiki",wikitext:"wiki",wit:"wit",wl:"wl",wolfram:"wl",xml:"xml",xsl:"xsl",yaml:"yaml",yml:"yml",zenscript:"zs",zig:"zig",zsh:"zsh",\u6587\u8A00:"wy"},Se=({onDownload:e,onError:t,language:n,children:o,className:a,code:r,...d})=>{let{code:s}=F(),{isAnimating:i}=useContext(M),c=r!=null?r:s,p=`file.${n&&n in Ne?Ne[n]:"txt"}`,m="text/plain",g=()=>{try{I(p,c,m),e==null||e();}catch(u){t==null||t(u);}};return jsx("button",{className:f("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),"data-streamdown":"code-block-download-button",disabled:i,onClick:g,title:"Download file",type:"button",...d,children:o!=null?o:jsx(DownloadIcon,{size:14})})};var me=()=>jsxs("div",{className:"w-full divide-y divide-border overflow-hidden rounded-xl border border-border",children:[jsx("div",{className:"h-[46px] w-full bg-muted/80"}),jsx("div",{className:"flex w-full items-center justify-center p-4",children:jsx(Loader2Icon,{className:"size-4 animate-spin"})})]});var go=/\.[^/.]+$/,Ee=({node:e,className:t,src:n,alt:o,...a})=>{let r=async()=>{if(n)try{let s=await(await fetch(n)).blob(),c=new URL(n,window.location.origin).pathname.split("/").pop()||"",l=c.split(".").pop(),p=c.includes(".")&&l!==void 0&&l.length<=4,m="";if(p)m=c;else {let g=s.type,u="png";g.includes("jpeg")||g.includes("jpg")?u="jpg":g.includes("png")?u="png":g.includes("svg")?u="svg":g.includes("gif")?u="gif":g.includes("webp")&&(u="webp"),m=`${(o||c||"image").replace(go,"")}.${u}`;}I(m,s,s.type);}catch(d){console.error("Failed to download image:",d);}};return n?jsxs("div",{className:"group relative my-4 inline-block","data-streamdown":"image-wrapper",children:[jsx("img",{alt:o,className:f("max-w-full rounded-lg",t),"data-streamdown":"image",src:n,...a}),jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-lg bg-black/10 group-hover:block"}),jsx("button",{className:f("absolute right-2 bottom-2 flex h-8 w-8 cursor-pointer items-center justify-center rounded-md border border-border bg-background/90 shadow-sm backdrop-blur-sm transition-all duration-200 hover:bg-background","opacity-0 group-hover:opacity-100"),onClick:r,title:"Download image",type:"button",children:jsx(DownloadIcon,{size:14})})]}):null};var G=async e=>{let n={...{startOnLoad:false,theme:"default",securityLevel:"strict",fontFamily:"monospace",suppressErrorRendering:true},...e},a=(await import('mermaid')).default;return a.initialize(n),a},De=(e,t)=>{var o;let n=(o=void 0)!=null?o:5;return new Promise((a,r)=>{let d="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e))),s=new Image;s.crossOrigin="anonymous",s.onload=()=>{let i=document.createElement("canvas"),c=s.width*n,l=s.height*n;i.width=c,i.height=l;let p=i.getContext("2d");if(!p){r(new Error("Failed to create 2D canvas context for PNG export"));return}p.drawImage(s,0,0,c,l),i.toBlob(m=>{if(!m){r(new Error("Failed to create PNG blob"));return}a(m);},"image/png");},s.onerror=()=>r(new Error("Failed to load SVG image")),s.src=d;})};var Le=({chart:e,children:t,className:n,onDownload:o,config:a,onError:r})=>{let[d,s]=useState(false),i=useRef(null),{isAnimating:c}=useContext(M),l=async p=>{try{if(p==="mmd"){I("diagram.mmd",e,"text/plain"),s(!1),o==null||o(p);return}let m=await G(a),g=e.split("").reduce((h,k)=>(h<<5)-h+k.charCodeAt(0)|0,0),u=`mermaid-${Math.abs(g)}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{svg:b}=await m.render(u,e);if(!b){r==null||r(new Error("SVG not found. Please wait for the diagram to render."));return}if(p==="svg"){I("diagram.svg",b,"image/svg+xml"),s(!1),o==null||o(p);return}if(p==="png"){let h=await De(b);I("diagram.png",h,"image/png"),o==null||o(p),s(!1);return}}catch(m){r==null||r(m);}};return useEffect(()=>{let p=m=>{i.current&&!i.current.contains(m.target)&&s(false);};return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p);}},[]),jsxs("div",{className:"relative",ref:i,children:[jsx("button",{className:f("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",n),disabled:c,onClick:()=>s(!d),title:"Download diagram",type:"button",children:t!=null?t:jsx(DownloadIcon,{size:14})}),d?jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>l("svg"),title:"Download diagram as SVG",type:"button",children:"SVG"}),jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>l("png"),title:"Download diagram as PNG",type:"button",children:"PNG"}),jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>l("mmd"),title:"Download diagram as MMD",type:"button",children:"MMD"})]}):null]})};var W=0,Po=()=>{W+=1,W===1&&(document.body.style.overflow="hidden");},No=()=>{W=Math.max(0,W-1),W===0&&(document.body.style.overflow="");},Oe=({chart:e,config:t,onFullscreen:n,onExit:o,className:a,...r})=>{let[d,s]=useState(false),{isAnimating:i,controls:c}=useContext(M),l=(()=>{if(typeof c=="boolean")return c;let m=c.mermaid;return m===false?false:m===true||m===void 0?true:m.panZoom!==false})(),p=()=>{s(!d);};return useEffect(()=>{if(d){Po();let m=g=>{g.key==="Escape"&&s(false);};return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m),No();}}},[d]),useEffect(()=>{d?n==null||n():o&&o();},[d,n,o]),jsxs(Fragment,{children:[jsx("button",{className:f("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),disabled:i,onClick:p,title:"View fullscreen",type:"button",...r,children:jsx(Maximize2Icon,{size:14})}),d?jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/95 backdrop-blur-sm",onClick:p,onKeyDown:m=>{m.key==="Escape"&&p();},role:"button",tabIndex:0,children:[jsx("button",{className:"absolute top-4 right-4 z-10 rounded-md p-2 text-muted-foreground transition-all hover:bg-muted hover:text-foreground",onClick:p,title:"Exit fullscreen",type:"button",children:jsx(XIcon,{size:20})}),jsx("div",{className:"flex size-full items-center justify-center p-4",onClick:m=>m.stopPropagation(),onKeyDown:m=>m.stopPropagation(),role:"presentation",children:jsx(je,{chart:e,className:"size-full [&_svg]:h-auto [&_svg]:w-auto",config:t,fullscreen:true,showControls:l})})]}):null]})};var Y=e=>{var r,d;let t=[],n=[],o=e.querySelectorAll("thead th");for(let s of o)t.push(((r=s.textContent)==null?void 0:r.trim())||"");let a=e.querySelectorAll("tbody tr");for(let s of a){let i=[],c=s.querySelectorAll("td");for(let l of c)i.push(((d=l.textContent)==null?void 0:d.trim())||"");n.push(i);}return {headers:t,rows:n}},Q=e=>{let{headers:t,rows:n}=e,o=s=>{let i=false,c=false;for(let l of s){if(l==='"'){i=true,c=true;break}(l===","||l===`
`)&&(i=true);}return i?c?`"${s.replace(/"/g,'""')}"`:`"${s}"`:s},a=t.length>0?n.length+1:n.length,r=new Array(a),d=0;t.length>0&&(r[d]=t.map(o).join(","),d+=1);for(let s of n)r[d]=s.map(o).join(","),d+=1;return r.join(`
`)},He=e=>{let{headers:t,rows:n}=e,o=s=>{let i=false;for(let l of s)if(l==="	"||l===`
`||l==="\r"){i=true;break}if(!i)return s;let c=[];for(let l of s)l==="	"?c.push("\\t"):l===`
`?c.push("\\n"):l==="\r"?c.push("\\r"):c.push(l);return c.join("")},a=t.length>0?n.length+1:n.length,r=new Array(a),d=0;t.length>0&&(r[d]=t.map(o).join("	"),d+=1);for(let s of n)r[d]=s.map(o).join("	"),d+=1;return r.join(`
`)},pe=e=>{let t=false;for(let o of e)if(o==="\\"||o==="|"){t=true;break}if(!t)return e;let n=[];for(let o of e)o==="\\"?n.push("\\\\"):o==="|"?n.push("\\|"):n.push(o);return n.join("")},qe=e=>{let{headers:t,rows:n}=e;if(t.length===0)return "";let o=new Array(n.length+2),a=0,r=t.map(s=>pe(s));o[a]=`| ${r.join(" | ")} |`,a+=1;let d=new Array(t.length);for(let s=0;s<t.length;s+=1)d[s]="---";o[a]=`| ${d.join(" | ")} |`,a+=1;for(let s of n)if(s.length<t.length){let i=new Array(t.length);for(let c=0;c<t.length;c+=1)i[c]=c<s.length?pe(s[c]):"";o[a]=`| ${i.join(" | ")} |`,a+=1;}else {let i=s.map(c=>pe(c));o[a]=`| ${i.join(" | ")} |`,a+=1;}return o.join(`
`)};var Ve=({children:e,className:t,onCopy:n,onError:o,timeout:a=2e3})=>{let[r,d]=useState(false),[s,i]=useState(false),c=useRef(null),l=useRef(0),{isAnimating:p}=useContext(M),m=async u=>{var b,h;if(typeof window=="undefined"||!((b=navigator==null?void 0:navigator.clipboard)!=null&&b.write)){o==null||o(new Error("Clipboard API not available"));return}try{let k=(h=c.current)==null?void 0:h.closest('[data-streamdown="table-wrapper"]'),C=k==null?void 0:k.querySelector("table");if(!C){o==null||o(new Error("Table not found"));return}let P=Y(C),x=u==="csv"?Q(P):He(P),N=new ClipboardItem({"text/plain":new Blob([x],{type:"text/plain"}),"text/html":new Blob([C.outerHTML],{type:"text/html"})});await navigator.clipboard.write([N]),i(!0),d(!1),n==null||n(u),l.current=window.setTimeout(()=>i(!1),a);}catch(k){o==null||o(k);}};useEffect(()=>{let u=b=>{c.current&&!c.current.contains(b.target)&&d(false);};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u),window.clearTimeout(l.current);}},[]);let g=s?CheckIcon:CopyIcon;return jsxs("div",{className:"relative",ref:c,children:[jsx("button",{className:f("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:p,onClick:()=>d(!r),title:"Copy table",type:"button",children:e!=null?e:jsx(g,{size:14})}),r?jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>m("csv"),title:"Copy table as CSV",type:"button",children:"CSV"}),jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>m("tsv"),title:"Copy table as TSV",type:"button",children:"TSV"})]}):null]})};var _e=({children:e,className:t,onDownload:n,onError:o})=>{let[a,r]=useState(false),d=useRef(null),{isAnimating:s}=useContext(M),i=c=>{var l;try{let p=(l=d.current)==null?void 0:l.closest('[data-streamdown="table-wrapper"]'),m=p==null?void 0:p.querySelector("table");if(!m){o==null||o(new Error("Table not found"));return}let g=Y(m),u=c==="csv"?Q(g):qe(g);I(`table.${c==="csv"?"csv":"md"}`,u,c==="csv"?"text/csv":"text/markdown"),r(!1),n==null||n(c);}catch(p){o==null||o(p);}};return useEffect(()=>{let c=l=>{d.current&&!d.current.contains(l.target)&&r(false);};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c);}},[]),jsxs("div",{className:"relative",ref:d,children:[jsx("button",{className:f("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:s,onClick:()=>r(!a),title:"Download table",type:"button",children:e!=null?e:jsx(DownloadIcon,{size:14})}),a?jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>i("csv"),title:"Download table as CSV",type:"button",children:"CSV"}),jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>i("markdown"),title:"Download table as Markdown",type:"button",children:"Markdown"})]}):null]})};var We=({children:e,className:t,showControls:n,...o})=>jsxs("div",{className:"my-4 flex flex-col space-y-2","data-streamdown":"table-wrapper",children:[n?jsxs("div",{className:"flex items-center justify-end gap-1",children:[jsx(Ve,{}),jsx(_e,{})]}):null,jsx("div",{className:"overflow-x-auto",children:jsx("table",{className:f("w-full border-collapse border border-border",t),"data-streamdown":"table",...o,children:e})})]});var Ho=lazy(()=>import('./code-block-RSLWVOB3.js').then(e=>({default:e.CodeBlock}))),qo=lazy(()=>import('./mermaid-YMBV2HD6.js').then(e=>({default:e.Mermaid}))),$o=/language-([^\s]+)/;function re(e,t){if(!(e!=null&&e.position||t!=null&&t.position))return  true;if(!(e!=null&&e.position&&(t!=null&&t.position)))return  false;let n=e.position.start,o=t.position.start,a=e.position.end,r=t.position.end;return (n==null?void 0:n.line)===(o==null?void 0:o.line)&&(n==null?void 0:n.column)===(o==null?void 0:o.column)&&(a==null?void 0:a.line)===(r==null?void 0:r.line)&&(a==null?void 0:a.column)===(r==null?void 0:r.column)}function T(e,t){return e.className===t.className&&re(e.node,t.node)}var fe=(e,t)=>typeof e=="boolean"?e:e[t]!==false,ne=(e,t)=>{if(typeof e=="boolean")return e;let n=e.mermaid;return n===false?false:n===true||n===void 0?true:n[t]!==false},ge=memo(({children:e,className:t,node:n,...o})=>jsx("ol",{className:f("list-inside list-decimal whitespace-normal [li_&]:pl-6",t),"data-streamdown":"ordered-list",...o,children:e}),(e,t)=>T(e,t));ge.displayName="MarkdownOl";var Ge=memo(({children:e,className:t,node:n,...o})=>jsx("li",{className:f("py-1 [&>p]:inline",t),"data-streamdown":"list-item",...o,children:e}),(e,t)=>e.className===t.className&&re(e.node,t.node));Ge.displayName="MarkdownLi";var Ye=memo(({children:e,className:t,node:n,...o})=>jsx("ul",{className:f("list-inside list-disc whitespace-normal [li_&]:pl-6",t),"data-streamdown":"unordered-list",...o,children:e}),(e,t)=>T(e,t));Ye.displayName="MarkdownUl";var Qe=memo(({className:e,node:t,...n})=>jsx("hr",{className:f("my-6 border-border",e),"data-streamdown":"horizontal-rule",...n}),(e,t)=>T(e,t));Qe.displayName="MarkdownHr";var et=memo(({children:e,className:t,node:n,...o})=>jsx("span",{className:f("font-semibold",t),"data-streamdown":"strong",...o,children:e}),(e,t)=>T(e,t));et.displayName="MarkdownStrong";var tt=memo(({children:e,className:t,href:n,node:o,...a})=>{let r=n==="streamdown:incomplete-link";return jsx("a",{className:f("wrap-anywhere font-medium text-primary underline",t),"data-incomplete":r,"data-streamdown":"link",href:n,rel:"noreferrer",target:"_blank",...a,children:e})},(e,t)=>T(e,t)&&e.href===t.href);tt.displayName="MarkdownA";var ot=memo(({children:e,className:t,node:n,...o})=>jsx("h1",{className:f("mt-6 mb-2 font-semibold text-3xl",t),"data-streamdown":"heading-1",...o,children:e}),(e,t)=>T(e,t));ot.displayName="MarkdownH1";var nt=memo(({children:e,className:t,node:n,...o})=>jsx("h2",{className:f("mt-6 mb-2 font-semibold text-2xl",t),"data-streamdown":"heading-2",...o,children:e}),(e,t)=>T(e,t));nt.displayName="MarkdownH2";var rt=memo(({children:e,className:t,node:n,...o})=>jsx("h3",{className:f("mt-6 mb-2 font-semibold text-xl",t),"data-streamdown":"heading-3",...o,children:e}),(e,t)=>T(e,t));rt.displayName="MarkdownH3";var st=memo(({children:e,className:t,node:n,...o})=>jsx("h4",{className:f("mt-6 mb-2 font-semibold text-lg",t),"data-streamdown":"heading-4",...o,children:e}),(e,t)=>T(e,t));st.displayName="MarkdownH4";var at=memo(({children:e,className:t,node:n,...o})=>jsx("h5",{className:f("mt-6 mb-2 font-semibold text-base",t),"data-streamdown":"heading-5",...o,children:e}),(e,t)=>T(e,t));at.displayName="MarkdownH5";var it=memo(({children:e,className:t,node:n,...o})=>jsx("h6",{className:f("mt-6 mb-2 font-semibold text-sm",t),"data-streamdown":"heading-6",...o,children:e}),(e,t)=>T(e,t));it.displayName="MarkdownH6";var lt=memo(({children:e,className:t,node:n,...o})=>{let{controls:a}=useContext(M),r=fe(a,"table");return jsx(We,{className:t,"data-streamdown":"table-wrapper",showControls:r,...o,children:e})},(e,t)=>T(e,t));lt.displayName="MarkdownTable";var ct=memo(({children:e,className:t,node:n,...o})=>jsx("thead",{className:f("bg-muted/80",t),"data-streamdown":"table-header",...o,children:e}),(e,t)=>T(e,t));ct.displayName="MarkdownThead";var dt=memo(({children:e,className:t,node:n,...o})=>jsx("tbody",{className:f("divide-y divide-border bg-muted/40",t),"data-streamdown":"table-body",...o,children:e}),(e,t)=>T(e,t));dt.displayName="MarkdownTbody";var mt=memo(({children:e,className:t,node:n,...o})=>jsx("tr",{className:f("border-border border-b",t),"data-streamdown":"table-row",...o,children:e}),(e,t)=>T(e,t));mt.displayName="MarkdownTr";var pt=memo(({children:e,className:t,node:n,...o})=>jsx("th",{className:f("whitespace-nowrap px-4 py-2 text-left font-semibold text-sm",t),"data-streamdown":"table-header-cell",...o,children:e}),(e,t)=>T(e,t));pt.displayName="MarkdownTh";var ut=memo(({children:e,className:t,node:n,...o})=>jsx("td",{className:f("px-4 py-2 text-sm",t),"data-streamdown":"table-cell",...o,children:e}),(e,t)=>T(e,t));ut.displayName="MarkdownTd";var ft=memo(({children:e,className:t,node:n,...o})=>jsx("blockquote",{className:f("my-4 border-muted-foreground/30 border-l-4 pl-4 text-muted-foreground italic",t),"data-streamdown":"blockquote",...o,children:e}),(e,t)=>T(e,t));ft.displayName="MarkdownBlockquote";var gt=memo(({children:e,className:t,node:n,...o})=>jsx("sup",{className:f("text-sm",t),"data-streamdown":"superscript",...o,children:e}),(e,t)=>T(e,t));gt.displayName="MarkdownSup";var bt=memo(({children:e,className:t,node:n,...o})=>jsx("sub",{className:f("text-sm",t),"data-streamdown":"subscript",...o,children:e}),(e,t)=>T(e,t));bt.displayName="MarkdownSub";var yt=memo(({children:e,className:t,node:n,...o})=>{if("data-footnotes"in o){let r=i=>{var m,g;if(!isValidElement(i))return  false;let c=Array.isArray(i.props.children)?i.props.children:[i.props.children],l=false,p=false;for(let u of c)if(u){if(typeof u=="string")u.trim()!==""&&(l=true);else if(isValidElement(u))if(((m=u.props)==null?void 0:m["data-footnote-backref"])!==void 0)p=true;else {let b=Array.isArray(u.props.children)?u.props.children:[u.props.children];for(let h of b){if(typeof h=="string"&&h.trim()!==""){l=true;break}if(isValidElement(h)&&((g=h.props)==null?void 0:g["data-footnote-backref"])===void 0){l=true;break}}}}return p&&!l},d=Array.isArray(e)?e.map(i=>{if(!isValidElement(i))return i;if(i.type===ge){let l=(Array.isArray(i.props.children)?i.props.children:[i.props.children]).filter(p=>!r(p));return l.length===0?null:{...i,props:{...i.props,children:l}}}return i}):e;return (Array.isArray(d)?d.some(i=>i!==null):d!==null)?jsx("section",{className:t,...o,children:d}):null}return jsx("section",{className:t,...o,children:e})},(e,t)=>T(e,t));yt.displayName="MarkdownSection";var zo=({node:e,className:t,children:n,...o})=>{var m,g,u;let a=((m=e==null?void 0:e.position)==null?void 0:m.start.line)===((g=e==null?void 0:e.position)==null?void 0:g.end.line),{mermaid:r,controls:d,onCodeApply:s}=useContext(M);if(a)return jsx("code",{className:f("rounded bg-muted px-1.5 py-0.5 font-mono text-sm",t),"data-streamdown":"inline-code",...o,children:n});let i=t==null?void 0:t.match($o),c=(u=i==null?void 0:i.at(1))!=null?u:"",l="";if(isValidElement(n)&&n.props&&typeof n.props=="object"&&"children"in n.props&&typeof n.props.children=="string"?l=n.props.children:typeof n=="string"&&(l=n),c==="mermaid"){let b=fe(d,"mermaid"),h=ne(d,"download"),k=ne(d,"copy"),C=ne(d,"fullscreen"),P=ne(d,"panZoom"),x=b&&(h||k||C);return jsx(Suspense,{fallback:jsx(me,{}),children:jsxs("div",{className:f("group relative my-4 h-auto rounded-xl border p-4",t),"data-streamdown":"mermaid-block",children:[x?jsxs("div",{className:"flex items-center justify-end gap-2",children:[h?jsx(Le,{chart:l,config:r==null?void 0:r.config}):null,k?jsx(ce,{code:l}):null,C?jsx(Oe,{chart:l,config:r==null?void 0:r.config}):null]}):null,jsx(qo,{chart:l,config:r==null?void 0:r.config,showControls:P})]})})}let p=fe(d,"code");return jsx(Suspense,{fallback:jsx(me,{}),children:jsx(Ho,{className:f("overflow-x-auto border-border border-t",t),code:l,language:c,children:p?jsxs(Fragment,{children:[jsx(Se,{code:l,language:c}),jsx(ce,{}),jsx(Me,{onApply:s})]}):null})})},ht=memo(zo,(e,t)=>e.className===t.className&&re(e.node,t.node));ht.displayName="MarkdownCode";var wt=memo(Ee,(e,t)=>e.className===t.className&&re(e.node,t.node));wt.displayName="MarkdownImg";var kt=memo(({children:e,className:t,node:n,...o})=>{var d;let r=(Array.isArray(e)?e:[e]).filter(s=>s!=null&&s!=="");return r.length===1&&isValidElement(r[0])&&((d=r[0].props.node)==null?void 0:d.tagName)==="img"?jsx(Fragment,{children:e}):jsx("p",{className:t,...o,children:e})},(e,t)=>T(e,t));kt.displayName="MarkdownParagraph";var xt={ol:ge,li:Ge,ul:Ye,hr:Qe,strong:et,a:tt,h1:ot,h2:nt,h3:rt,h4:st,h5:at,h6:it,table:lt,thead:ct,tbody:dt,tr:mt,th:pt,td:ut,blockquote:ft,code:ht,img:wt,pre:({children:e})=>e,sup:gt,sub:bt,p:kt,section:yt};var Ct=[],Tt={allowDangerousHtml:true},se=new WeakMap,be=class{constructor(){this.cache=new Map;this.keyCache=new WeakMap;this.maxSize=100;}generateCacheKey(t){let n=this.keyCache.get(t);if(n)return n;let o=t.rehypePlugins,a=t.remarkPlugins,r=t.remarkRehypeOptions;if(!(o||a||r)){let p="default";return this.keyCache.set(t,p),p}let d=p=>{if(!p||p.length===0)return "";let m="";for(let g=0;g<p.length;g+=1){let u=p[g];if(g>0&&(m+=","),Array.isArray(u)){let[b,h]=u;if(typeof b=="function"){let k=se.get(b);k||(k=b.name,se.set(b,k)),m+=k;}else m+=String(b);m+=":",m+=JSON.stringify(h);}else if(typeof u=="function"){let b=se.get(u);b||(b=u.name,se.set(u,b)),m+=b;}else m+=String(u);}return m},s=d(o),i=d(a),c=r?JSON.stringify(r):"",l=`${i}::${s}::${c}`;return this.keyCache.set(t,l),l}get(t){let n=this.generateCacheKey(t),o=this.cache.get(n);return o&&(this.cache.delete(n),this.cache.set(n,o)),o}set(t,n){let o=this.generateCacheKey(t);if(this.cache.size>=this.maxSize){let a=this.cache.keys().next().value;a&&this.cache.delete(a);}this.cache.set(o,n);}clear(){this.cache.clear();}},Mt=new be,ye=e=>{let t=Ko(e),n=e.children||"";return Go(t.runSync(t.parse(n),n),e)},Ko=e=>{let t=Mt.get(e);if(t)return t;let n=Zo(e);return Mt.set(e,n),n},Zo=e=>{let t=e.rehypePlugins||Ct,n=e.remarkPlugins||Ct,o=e.remarkRehypeOptions?{...Tt,...e.remarkRehypeOptions}:Tt;return unified().use(Jo).use(n).use(Wo,o).use(t)},Go=(e,t)=>toJsxRuntime(e,{Fragment:Fragment,components:t.components,ignoreInvalidStyle:true,jsx:jsx,jsxs:jsxs,passKeys:true,passNode:true});var Qo=/\[\^[^\]\s]{1,200}\](?!:)/,en=/\[\^[^\]\s]{1,200}\]:/,tn=/<\/(\w+)>/,on=/<(\w+)[\s>]/,he=e=>{let t=0;for(;t<e.length&&(e[t]===" "||e[t]==="	"||e[t]===`
`||e[t]==="\r");)t+=1;return t+1<e.length&&e[t]==="$"&&e[t+1]==="$"},nn=e=>{let t=e.length-1;for(;t>=0&&(e[t]===" "||e[t]==="	"||e[t]===`
`||e[t]==="\r");)t-=1;return t>=1&&e[t]==="$"&&e[t-1]==="$"},we=e=>{let t=0;for(let n=0;n<e.length-1;n+=1)e[n]==="$"&&e[n+1]==="$"&&(t+=1,n+=1);return t},ke=e=>{let t=Qo.test(e),n=en.test(e);if(t||n)return [e];let o=Lexer.lex(e,{gfm:true}),a=[],r=[];for(let d of o){let s=d.raw,i=a.length;if(r.length>0){if(a[i-1]+=s,d.type==="html"){let l=s.match(tn);if(l){let p=l[1];r.at(-1)===p&&r.pop();}}continue}if(d.type==="html"&&d.block){let l=s.match(on);if(l){let p=l[1];s.includes(`</${p}>`)||r.push(p);}}if(s.trim()==="$$"&&i>0){let l=a[i-1],p=he(l),m=we(l);if(p&&m%2===1){a[i-1]=l+s;continue}}if(i>0&&nn(s)){let l=a[i-1],p=he(l),m=we(l),g=we(s);if(p&&m%2===1&&!he(s)&&g===1){a[i-1]=l+s;continue}}a.push(s);}return a};var Pt={name:"streamdown",version:"1.6.10",type:"module",main:"./dist/index.js",module:"./dist/index.js",types:"./dist/index.d.ts",exports:{".":{types:"./dist/index.d.ts",import:"./dist/index.js",require:"./dist/index.cjs"}},files:["dist","README.md"],homepage:"https://streamdown.ai",repository:{type:"git",url:"git+https://github.com/vercel/streamdown.git",directory:"packages/streamdown"},scripts:{build:"tsup",postbuild:"node scripts/postbuild.js",test:"vitest run","test:ui":"vitest --ui run","test:coverage":"vitest --coverage run",bench:"vitest bench --run > results.txt","bench:ui":"vitest bench --ui --run"},author:"Hayden Bleasel <hayden.bleasel@vercel.com>",license:"Apache-2.0",description:"A drop-in replacement for react-markdown, designed for AI-powered streaming.",devDependencies:{"@testing-library/jest-dom":"^6.9.1","@testing-library/react":"^16.3.0","@types/hast":"^3.0.4","@types/react":"^19.2.7","@types/react-dom":"^19.2.3","@vitejs/plugin-react":"^5.1.2","@vitest/coverage-v8":"^4.0.15",jsdom:"^27.3.0",react:"^19.2.1","react-dom":"^19.2.1","react-markdown":"^10.1.0",tsup:"^8.5.1",vitest:"^4.0.15"},peerDependencies:{react:"^18.0.0 || ^19.0.0"},dependencies:{clsx:"^2.1.1",hast:"^1.0.0","hast-util-to-jsx-runtime":"^2.3.6","html-url-attributes":"^3.0.1","lucide-react":"^0.560.0",marked:"^17.0.1",mermaid:"^11.12.2","rehype-harden":"^1.1.7","rehype-katex":"^7.0.1","rehype-raw":"^7.0.0","rehype-sanitize":"^6.0.0","remark-cjk-friendly":"^1.2.3","remark-cjk-friendly-gfm-strikethrough":"^1.2.3","remark-gfm":"^4.0.1","remark-math":"^6.0.0","remark-parse":"^11.0.0","remark-rehype":"^11.1.2",remend:"workspace:*",shiki:"^3.19.0","tailwind-merge":"^3.4.0",unified:"^11.0.5","unist-util-visit":"^5.0.0"}};var Lt={javascript:ln,typescript:fn,jsx:dn,tsx:un,html:an,css:sn,json:cn,bash:Nt,shellscript:Dt,shell:Dt,sh:Nt,yaml:It,yml:It,toml:pn,python:Et,py:Et,markdown:St,md:St,sql:mn,go:Rt,golang:Rt},gn=e=>e in Lt;var Nn=/[^$]\$[^$]/,Rn=/^\$[^$]/,Sn=/[^$]\$$/,En={raw:xn,sanitize:[vn,{}],katex:[xe,{errorColor:"var(--color-muted-foreground)"}],harden:[harden,{allowedImagePrefixes:["*"],allowedLinkPrefixes:["*"],allowedProtocols:["*"],defaultOrigin:void 0,allowDataImages:true}]},Dn={gfm:[Mn,{}],math:[ve,{singleDollarTextMath:false}],cjkFriendly:[Cn,{}],cjkFriendlyGfmStrikethrough:[Tn,{}]},In=Object.values(En),Ln=Object.values(Dn),Bn={block:" \u258B",circle:" \u25CF"},An={shikiTheme:["github-light","github-dark"],controls:true,isAnimating:false,mode:"streaming",mermaid:void 0,cdnUrl:void 0,onCodeApply:void 0},M=createContext(An),jt=memo(({content:e,...t})=>jsx(ye,{...t,children:e}),(e,t)=>{if(e.content!==t.content||e.index!==t.index)return  false;if(e.components!==t.components){let n=Object.keys(e.components||{}),o=Object.keys(t.components||{});if(n.length!==o.length||n.some(a=>{var r,d;return ((r=e.components)==null?void 0:r[a])!==((d=t.components)==null?void 0:d[a])}))return  false}return !(e.rehypePlugins!==t.rehypePlugins||e.remarkPlugins!==t.remarkPlugins)});jt.displayName="Block";var jn=["github-light","github-dark"],On=e=>Array.isArray(e)&&e.some(t=>Array.isArray(t)?t[0]===xe:t===xe),Hn=e=>{if(!Array.isArray(e))return  false;let t=e.find(n=>Array.isArray(n)?n[0]===ve:n===ve);return t&&Array.isArray(t)&&t[1]?t[1].singleDollarTextMath===true:false},qn=(e,t)=>{let n=e.includes("$$"),o=t&&(Nn.test(e)||Rn.test(e)||Sn.test(e));return n||o},$n=/^\^/,zn=()=>{let e=Pt.dependencies["rehype-katex"].replace($n,"").split(".")[0],n={7:"0.16.22"}[e]||"0.16.22",o=document.createElement("link");o.rel="stylesheet",o.href=`/cdn/katex/${n}/katex.min.css`,document.head.appendChild(o);},Fn=memo(({children:e,mode:t="streaming",parseIncompleteMarkdown:n=true,components:o,rehypePlugins:a=In,remarkPlugins:r=Ln,className:d,shikiTheme:s=jn,mermaid:i,controls:c=true,isAnimating:l=false,BlockComponent:p=jt,parseMarkdownIntoBlocksFn:m=ke,caret:g,cdnUrl:u,remend:b,onCodeApply:h,...k})=>{let C=useId(),[P,x]=useTransition(),[N,S]=useState([]),L=useMemo(()=>typeof e!="string"?"":t==="streaming"&&n?Pn(e,b):e,[e,t,n,b]),E=useMemo(()=>m(L),[L,m]);useEffect(()=>{t==="streaming"?x(()=>{S(E);}):S(E);},[E,t]);let B=t==="streaming"?N:E,O=useMemo(()=>B.map(($,z)=>`${C}-${z}`),[B.length,C]),A=useMemo(()=>({shikiTheme:s,controls:c,isAnimating:l,mode:t,mermaid:i,cdnUrl:u,onCodeApply:h}),[s,c,l,t,i,u,h]),w=useMemo(()=>({...xt,...o}),[o]);useEffect(()=>{if(!On(a))return;let z=Hn(r);qn(typeof e=="string"?e:"",z)&&zn();},[a,r,e]);let R=useMemo(()=>g&&l?{"--streamdown-caret":`"${Bn[g]}"`}:void 0,[g,l]);return t==="static"?jsx(M.Provider,{value:A,children:jsx("div",{className:f("space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0",d),children:jsx(ye,{components:w,rehypePlugins:a,remarkPlugins:r,...k,children:e})})}):jsx(M.Provider,{value:A,children:jsx("div",{className:f("space-y-4 whitespace-normal *:first:mt-0 *:last:mb-0",g?"*:last:after:inline *:last:after:align-baseline *:last:after:content-(--streamdown-caret)":null,d),style:R,children:B.map(($,z)=>jsx(p,{components:w,content:$,index:z,rehypePlugins:a,remarkPlugins:r,shouldParseIncompleteMarkdown:n,...k},O[z]))})})},(e,t)=>e.children===t.children&&e.shikiTheme===t.shikiTheme&&e.isAnimating===t.isAnimating&&e.mode===t.mode);Fn.displayName="Streamdown";var $t=({children:e,className:t,minZoom:n=.5,maxZoom:o=3,zoomStep:a=.1,showControls:r=true,initialZoom:d=1,fullscreen:s=false})=>{let i=useRef(null),c=useRef(null),[l,p]=useState(d),[m,g]=useState({x:0,y:0}),[u,b]=useState(false),[h,k]=useState({x:0,y:0}),[C,P]=useState({x:0,y:0}),x=useCallback(w=>{p(R=>Math.max(n,Math.min(o,R+w)));},[n,o]),N=useCallback(()=>{x(a);},[x,a]),S=useCallback(()=>{x(-a);},[x,a]),L=useCallback(()=>{p(d),g({x:0,y:0});},[d]),E=useCallback(w=>{w.preventDefault();let R=w.deltaY>0?-a:a;x(R);},[x,a]),B=useCallback(w=>{if(w.button!==0||w.isPrimary===false)return;b(true),k({x:w.clientX,y:w.clientY}),P(m);let R=w.currentTarget;R instanceof HTMLElement&&R.setPointerCapture(w.pointerId);},[m]),O=useCallback(w=>{if(!u)return;w.preventDefault();let R=w.clientX-h.x,$=w.clientY-h.y;g({x:C.x+R,y:C.y+$});},[u,h,C]),A=useCallback(w=>{b(false);let R=w.currentTarget;R instanceof HTMLElement&&R.releasePointerCapture(w.pointerId);},[]);return useEffect(()=>{let w=i.current;if(w)return w.addEventListener("wheel",E,{passive:false}),()=>{w.removeEventListener("wheel",E);}},[E]),useEffect(()=>{let w=c.current;if(w&&u)return document.body.style.userSelect="none",w.addEventListener("pointermove",O,{passive:false}),w.addEventListener("pointerup",A),w.addEventListener("pointercancel",A),()=>{document.body.style.userSelect="",w.removeEventListener("pointermove",O),w.removeEventListener("pointerup",A),w.removeEventListener("pointercancel",A);}},[u,O,A]),jsxs("div",{className:f("relative flex flex-col",s?"h-full w-full":"min-h-28 w-full",t),ref:i,style:{cursor:u?"grabbing":"grab"},children:[r?jsxs("div",{className:f("absolute z-10 flex flex-col gap-1 rounded-md border border-border bg-background/90 p-1 shadow-sm backdrop-blur-sm",s?"bottom-4 left-4":"bottom-2 left-2"),children:[jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:l>=o,onClick:N,title:"Zoom in",type:"button",children:jsx(ZoomInIcon,{size:16})}),jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:l<=n,onClick:S,title:"Zoom out",type:"button",children:jsx(ZoomOutIcon,{size:16})}),jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",onClick:L,title:"Reset zoom and pan",type:"button",children:jsx(RotateCcwIcon,{size:16})})]}):null,jsx("div",{className:f("flex-1 origin-center transition-transform duration-150 ease-out",s?"flex h-full w-full items-center justify-center":"flex w-full items-center justify-center"),onPointerDown:B,ref:c,role:"application",style:{transform:`translate(${m.x}px, ${m.y}px) scale(${l})`,transformOrigin:"center center",touchAction:"none",willChange:"transform"},children:e})]})};var je=({chart:e,className:t,config:n,fullscreen:o=false,showControls:a=true})=>{let[r,d]=useState(null),[s,i]=useState(false),[c,l]=useState(""),[p,m]=useState(""),[g,u]=useState(0),{mermaid:b}=useContext(M),h=b==null?void 0:b.errorComponent,{shouldRender:k,containerRef:C}=Ce({immediate:o});if(useEffect(()=>{if(!k)return;(async()=>{try{d(null),i(!0);let N=await G(n),S=e.split("").reduce((B,O)=>(B<<5)-B+O.charCodeAt(0)|0,0),L=`mermaid-${Math.abs(S)}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{svg:E}=await N.render(L,e);l(E),m(E);}catch(N){if(!(p||c)){let S=N instanceof Error?N.message:"Failed to render Mermaid chart";d(S);}}finally{i(false);}})();},[e,n,g,k]),!(k||c||p))return jsx("div",{className:f("my-4 min-h-[200px]",t),ref:C});if(s&&!c&&!p)return jsx("div",{className:f("my-4 flex justify-center p-4",t),ref:C,children:jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-current border-b-2"}),jsx("span",{className:"text-sm",children:"Loading diagram..."})]})});if(r&&!c&&!p){let x=()=>u(N=>N+1);return h?jsx("div",{ref:C,children:jsx(h,{chart:e,error:r,retry:x})}):jsxs("div",{className:f("rounded-lg border border-red-200 bg-red-50 p-4",t),ref:C,children:[jsxs("p",{className:"font-mono text-red-700 text-sm",children:["Mermaid Error: ",r]}),jsxs("details",{className:"mt-2",children:[jsx("summary",{className:"cursor-pointer text-red-600 text-xs",children:"Show Code"}),jsx("pre",{className:"mt-2 overflow-x-auto rounded bg-red-100 p-2 text-red-800 text-xs",children:e})]})]})}let P=c||p;return jsx("div",{className:"size-full",ref:C,children:jsx($t,{className:f(o?"size-full overflow-hidden":"my-4 overflow-hidden",t),fullscreen:o,maxZoom:3,minZoom:.5,showControls:a,zoomStep:.1,children:jsx("div",{"aria-label":"Mermaid chart",className:f("flex justify-center",o?"size-full items-center":null),dangerouslySetInnerHTML:{__html:P},role:"img"})})})};
export{f as a,Zt as b,je as c,Lt as d,gn as e,Pt as f,ke as g,En as h,Dn as i,M as j,jt as k,Fn as l};